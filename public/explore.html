<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gloss - Explore</title>
  <link rel="stylesheet" href="/_gloss/css/tw.opt.css">
  <link rel="stylesheet" href="/_gloss/css/app.css">
  <script src="_gloss/js/features.js"></script>
  
      <link
        rel="stylesheet"
        href="https://site-assets.fontawesome.com/releases/v6.7.2/css/all.css"
      >
  
  <link rel="stylesheet" href="https://furcan.github.io/IconPicker/dist/iconpicker-1.5.0.css">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">

  <style>
    .app-list-container::-webkit-scrollbar {
      width: 8px;
    }
    .app-list-container::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
    }
    .app-list-container::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 4px;
    }

    .app-item:hover {
      background: linear-gradient(90deg, rgba(147, 51, 234, 0.2) 0%, transparent 70%);
    }
    .category-card:hover {
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }
    .btn-primary:hover {
      box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }

    .fade-in {
      animation: fadeIn 0.5s ease forwards;
    }
    .fade-out {
      animation: fadeOut 0.3s ease forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-20px); }
    }

    select option {
      background: rgba(30, 30, 30, 0.95);
      color: #e5e7eb;
    }

    .iconpicker-popover {
      background: rgba(0, 0, 0, 0.95) !important;
      backdrop-filter: blur(20px) !important;
      border: 1px solid rgba(255, 255, 255, 0.1) !important;
      border-radius: 12px !important;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3) !important;
    }
    
    .iconpicker-popover .iconpicker-search {
      background: rgba(0, 0, 0, 0.3) !important;
      border: 1px solid rgba(255, 255, 255, 0.2) !important;
      color: white !important;
      border-radius: 8px !important;
    }
    
    .iconpicker-popover .iconpicker-search::placeholder {
      color: rgba(255, 255, 255, 0.5) !important;
    }
    .ip-icons-content {
      background-color: black!important
    }
    .iconpicker-popover .iconpicker-items {
      background: transparent !important;
    }
    
    .iconpicker-popover .iconpicker-item {
      color: white !important;
      border-radius: 8px !important;
      transition: all 0.2s ease !important;
    }
    
    .iconpicker-popover .iconpicker-item:hover {
      background: rgba(147, 51, 234, 0.2) !important;
      transform: translateY(-2px) !important;
    }
    
    .iconpicker-popover .iconpicker-item.iconpicker-selected {
      background: rgba(147, 51, 234, 0.4) !important;
      border-color: rgba(147, 51, 234, 0.6) !important;
    }
    
    .iconpicker-popover .iconpicker-buttons button {
      background: rgba(147, 51, 234, 0.2) !important;
      color: white !important;
      border: 1px solid rgba(147, 51, 234, 0.3) !important;
      border-radius: 8px !important;
      transition: all 0.2s ease !important;
    }
    
    .iconpicker-popover .iconpicker-buttons button:hover {
      background: rgba(147, 51, 234, 0.4) !important;
      transform: translateY(-1px) !important;
    }
    
    .iconpicker-popover * {
      background-color: transparent !important;
    }
    
    .iconpicker-popover .iconpicker-popover-content {
      background: rgba(0, 0, 0, 0.95) !important;
    }
    
    .iconpicker-popover .iconpicker-header {
      background: rgba(0, 0, 0, 0.8) !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
    }
    
    .iconpicker-popover .iconpicker-body {
      background: rgba(0, 0, 0, 0.95) !important;
    }
    
    .iconpicker-popover .iconpicker-footer {
      background: rgba(0, 0, 0, 0.8) !important;
      border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
    }
    
    .iconpicker-popover .iconpicker-item {
      background: rgba(0, 0, 0, 0.3) !important;
      border: 1px solid rgba(255, 255, 255, 0.1) !important;
    }
    
  </style>

</head>
<body class="gradient-bg min-h-screen text-gray-100 overflow-x-hidden flex flex-col">
  <div class="fixed inset-0 -z-10 animate-fadeIn">
    <div class="absolute top-0 left-1/4 w-64 h-64 rounded-full bg-indigo-900/10 blur-3xl"></div>
    <div class="absolute bottom-1/4 right-1/3 w-96 h-96 rounded-full bg-purple-900/10 blur-3xl"></div>
  </div>
  <header class="fixed top-0 left-0 right-0 z-50 animate-fadeIn delay-1 flex justify-center">
    <nav class="glass mx-auto my-3 px-4 py-2 flex items-center justify-between shadow-lg rounded-full w-auto max-w-xl">
      <div class="flex items-center mr-12">
        <div class="logo-gradient"></div>
      </div>
      
      <div class="flex items-center space-x-4 mx-auto">
        <a href="/" class="nav-item text-gray-300 hover:text-white">
          <i class="fas fa-home"></i>Home
        </a>
        <a href="/explore" class="nav-item text-gray-300 hover:text-white">
          <i class="fas fa-compass"></i>Explore
        </a>
        <a href="/settings" class="nav-item text-gray-300 hover:text-white">
          <i class="fas fa-gear"></i>Settings
        </a>
      </div>
      <div class="ml-12">
        <button onclick="verifyAppStateIntegrity();" class="w-6 h-6 rounded-full flex items-center justify-center hover:opacity-90 transition-opacity">
          <i class="fas fa-info text-xs gradient-text"></i>
        </button>
      </div>
    </nav>
  </header>
  <main class="flex flex-col items-center justify-center flex-grow px-4">
    <div id="categoryView" class="text-center animate-fadeUp delay-2">
      <div class="mb-8">
        <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-indigo-400 to-purple-400 text-transparent bg-clip-text">Explore Apps</h1>
        <p class="text-gray-400 max-w-md mx-auto text-sm">What kind of apps are you looking for?</p>
      </div>
      
      <div id="categoryGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-4xl mx-auto">
      </div>
      
      <div class="flex gap-4 justify-center mt-8 flex-wrap">
        <button class="glass px-6 py-3 rounded-xl text-white font-medium cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:border-purple-400/30 flex items-center gap-2" onclick="openManualCreatorModal()">
          <i class="fas fa-plus"></i>
          Create Manually
        </button>
        <button class="glass px-6 py-3 rounded-xl text-white font-medium cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:border-purple-400/30 flex items-center gap-2" onclick="openImportModal()">
          <i class="fas fa-download"></i>
          Import via JSON
        </button>
        <button class="glass px-6 py-3 rounded-xl text-white font-medium cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:border-purple-400/30 flex items-center gap-2" onclick="openExportModal()">
          <i class="fas fa-upload"></i>
          Export to JSON
        </button>
        <button class="glass px-6 py-3 rounded-xl text-white font-medium cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:border-red-400/30 flex items-center gap-2" onclick="resetToDefaults()">
          <i class="fas fa-refresh"></i>
          Reset to Defaults
        </button>
      </div>
    </div>

    <div id="appListView" class="w-full max-w-4xl mx-auto hidden">
      <div class="flex items-center justify-between mb-8 gap-4 flex-wrap">
        <button class="glass px-6 py-3 rounded-xl text-white font-medium cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:border-purple-400/30 flex items-center gap-2" onclick="goBackToCategories()">
          <i class="fas fa-arrow-left"></i>
          Back
        </button>
        
        <div class="flex-1 max-w-md">
          <input type="text" id="appSearch" class="w-full glass px-4 py-3 rounded-xl text-white outline-none transition-all duration-300 focus:border-purple-400/50 focus:shadow-purple-400/10 focus:shadow-lg" placeholder="Search apps...">
        </div>
        
        <select id="sortFilter" class="glass px-4 py-3 rounded-xl text-white outline-none cursor-pointer">
          <option value="name-asc">A-Z</option>
          <option value="name-desc">Z-A</option>
          <option value="popular">Most Popular</option>
          <option value="recent">Recently Added</option>
        </select>
        
        <button class="glass px-4 py-3 rounded-xl text-white font-medium cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:border-purple-400/30 flex items-center gap-2" onclick="openImportModal()">
          <i class="fas fa-download"></i>
          Import
        </button>
        <button class="glass px-4 py-3 rounded-xl text-white font-medium cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:border-purple-400/30 flex items-center gap-2" onclick="openExportModal()">
          <i class="fas fa-upload"></i>
          Export
        </button>
        <button class="glass px-4 py-3 rounded-xl text-white font-medium cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:border-red-400/30 flex items-center gap-2" onclick="resetToDefaults()">
          <i class="fas fa-refresh"></i>
          Reset
        </button>
      </div>
      
      <div class="app-list-container max-w-4xl mx-auto max-h-[60vh] overflow-y-auto glass rounded-2xl p-4">
        <div id="appContainer">
        </div>
      </div>
    </div>

    <div id="importModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 opacity-0 invisible transition-all duration-300">
      <div class="glass max-w-2xl w-[90%] max-h-[80vh] overflow-y-auto rounded-2xl p-8 text-white">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 text-transparent bg-clip-text">Import Apps from JSON</h2>
          <button class="text-white text-2xl p-2 rounded-lg transition-colors hover:bg-white/10" onclick="closeModal('importModal')">&times;</button>
        </div>
        <div class="mb-6">
          <p class="text-gray-300 mb-3">Paste your JSON data below:</p>
          <textarea id="importData" class="w-full min-h-[200px] bg-black/30 border border-white/20 rounded-lg p-4 text-white outline-none font-mono text-sm resize-y" placeholder='{"categories": {"games": [{"name": "Game Name", "description": "Game description", "icon": "icon_url", "url": "app_url"}]}}'></textarea>
        </div>
        <div class="flex gap-3 justify-end">
          <button class="glass px-6 py-3 rounded-xl text-white transition-all duration-300 hover:-translate-y-1" onclick="closeModal('importModal')">Cancel</button>
          <button class="glass px-6 py-3 rounded-xl text-white transition-all duration-300 hover:-translate-y-1 flex items-center gap-2" onclick="importFromJSON()">
            <i class="fas fa-download"></i>
            Import
          </button>
        </div>
        <div class="mt-6">
          <details class="cursor-pointer">
            <summary class="text-gray-300 mb-2 select-none">Show JSON Format Example</summary>
            <pre class="text-xs text-gray-400 bg-black/20 p-4 rounded-lg border border-white/10 overflow-x-auto">
{
  "categories": {
    "games": {
      "name": "Games",
      "icon": "🎮",
      "description": "Racing, action, puzzle games and more",
      "apps": [
        {
          "name": "2048",
          "description": "Addictive number puzzle game",
          "icon": "https://example.com/icon.png",
          "url": "https://2048game.com"
        }
      ]
    }
  }
}
            </pre>
          </details>
        </div>
      </div>
    </div>

    <div id="exportModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 opacity-0 invisible transition-all duration-300">
      <div class="glass max-w-2xl w-[90%] max-h-[80vh] overflow-y-auto rounded-2xl p-8 text-white">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 text-transparent bg-clip-text">Export Apps to JSON</h2>
          <button class="text-white text-2xl p-2 rounded-lg transition-colors hover:bg-white/10" onclick="closeModal('exportModal')">&times;</button>
        </div>
        <div class="mb-6">
          <p class="text-gray-300 mb-3">Select what to export:</p>
          <div id="exportOptions" class="max-h-80 overflow-y-auto border border-white/20 rounded-lg p-4 bg-black/20">
          </div>
        </div>
        <div class="mb-6">
          <p class="text-gray-300 mb-2">Exported JSON:</p>
          <textarea id="exportData" class="w-full min-h-[200px] bg-black/30 border border-white/20 rounded-lg p-4 text-white outline-none font-mono text-sm resize-y" readonly></textarea>
        </div>
        <div class="flex gap-3 justify-end">
          <button class="glass px-6 py-3 rounded-xl text-white transition-all duration-300 hover:-translate-y-1" onclick="closeModal('exportModal')">Close</button>
          <button class="glass px-6 py-3 rounded-xl text-white transition-all duration-300 hover:-translate-y-1 flex items-center gap-2" onclick="copyToClipboard()">
            <i class="fas fa-copy"></i>
            Copy to Clipboard
          </button>
        </div>
      </div>
    </div>

    <div id="manualCreatorModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 opacity-0 invisible transition-all duration-300">
      <div class="glass max-w-3xl w-[90%] max-h-[85vh] overflow-y-auto rounded-2xl p-8 text-white">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 text-transparent bg-clip-text">Create New Item</h2>
          <button class="text-white text-2xl p-2 rounded-lg transition-colors hover:bg-white/10" onclick="closeModal('manualCreatorModal')">&times;</button>
        </div>
        
        <div class="mb-6">
          <p class="text-gray-300 mb-3">What would you like to create?</p>
          <div class="flex gap-4">
            <button id="createCategoryBtn" class="glass px-6 py-3 rounded-xl text-white font-medium cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:border-purple-400/30 flex items-center gap-2" onclick="setCreationType('category')">
              <i class="fas fa-folder"></i>
              New Category
            </button>
            <button id="createAppBtn" class="glass px-6 py-3 rounded-xl text-white font-medium cursor-pointer transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:border-purple-400/30 flex items-center gap-2" onclick="setCreationType('app')">
              <i class="fas fa-cube"></i>
              New App
            </button>
          </div>
        </div>

        <div id="creationForm" class="hidden">
          <div id="categoryForm" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-gray-300 mb-2">Category Name</label>
                <input type="text" id="categoryName" class="w-full bg-black/30 border border-white/20 rounded-lg p-3 text-white outline-none focus:border-purple-400/50" placeholder="e.g., Games">
              </div>
              <div>
                <label class="block text-gray-300 mb-2">Category Key</label>
                <input type="text" id="categoryKey" class="w-full bg-black/30 border border-white/20 rounded-lg p-3 text-white outline-none focus:border-purple-400/50" placeholder="e.g., games (auto-generated)">
              </div>
              <div class="md:col-span-2">
                <label class="block text-gray-300 mb-2">Description</label>
                <textarea id="categoryDescription" class="w-full bg-black/30 border border-white/20 rounded-lg p-3 text-white outline-none focus:border-purple-400/50 resize-y" rows="2" placeholder="Brief description of this category"></textarea>
              </div>
              
              <div class="md:col-span-2">
                <label class="block text-gray-300 mb-2">Icon Type</label>
                <div class="flex gap-4 mb-4">
                  <button class="icon-type-btn glass px-4 py-2 rounded-lg text-white transition-all duration-300 hover:-translate-y-1" data-type="emoji" onclick="selectIconType('category', 'emoji')">
                    <i class="fas fa-smile"></i>
                    Emoji
                  </button>
                  <button class="icon-type-btn glass px-4 py-2 rounded-lg text-white transition-all duration-300 hover:-translate-y-1" data-type="fontawesome" onclick="selectIconType('category', 'fontawesome')">
                    <i class="fas fa-icons"></i>
                    FontAwesome
                  </button>
                  <button class="icon-type-btn glass px-4 py-2 rounded-lg text-white transition-all duration-300 hover:-translate-y-1" data-type="image" onclick="selectIconType('category', 'image')">
                    <i class="fas fa-image"></i>
                    Image URL
                  </button>
                </div>
                
                <div id="categoryEmojiInput" class="hidden">
                  <input type="text" id="categoryEmoji" class="w-full bg-black/30 border border-white/20 rounded-lg p-3 text-white outline-none focus:border-purple-400/50" placeholder="🎮" maxlength="4">
                </div>
                <div id="categoryFontAwesomeInput" class="hidden">
                  <div class="flex gap-2 items-center">
                    <input type="text" id="categoryFontAwesome" class="flex-1 bg-black/30 border border-white/20 rounded-lg p-3 text-white outline-none focus:border-purple-400/50" placeholder="fas fa-gamepad" oninput="updateIconPreview('category', this.value)">
                    <i id="categoryIconPreview" class="fas fa-folder text-2xl text-white"></i>
                    <button type="button" id="categoryIconPickerBtn" class="glass px-4 py-3 rounded-lg text-white transition-all duration-300 hover:-translate-y-1" data-iconpicker-input="input#categoryFontAwesome" data-iconpicker-preview="i#categoryIconPreview">
                      <i class="fas fa-search"></i>
                    </button>
                  </div>
                  <p class="text-gray-400 text-xs mt-2">Enter FontAwesome class or use the search button. Examples: fas fa-home, fab fa-github, fas fa-star</p>
                </div>
                <div id="categoryImageInput" class="hidden">
                  <input type="url" id="categoryImageUrl" class="w-full bg-black/30 border border-white/20 rounded-lg p-3 text-white outline-none focus:border-purple-400/50" placeholder="https://example.com/icon.png">
                </div>
              </div>
            </div>
          </div>

          <div id="appForm" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-gray-300 mb-2">App Name</label>
                <input type="text" id="appName" class="w-full bg-black/30 border border-white/20 rounded-lg p-3 text-white outline-none focus:border-purple-400/50" placeholder="e.g., 2048">
              </div>
              <div>
                <label class="block text-gray-300 mb-2">Category</label>
                <select id="appCategory" class="w-full bg-black/30 border border-white/20 rounded-lg p-3 text-white outline-none focus:border-purple-400/50">
                </select>
              </div>
              <div class="md:col-span-2">
                <label class="block text-gray-300 mb-2">Description</label>
                <textarea id="appDescription" class="w-full bg-black/30 border border-white/20 rounded-lg p-3 text-white outline-none focus:border-purple-400/50 resize-y" rows="2" placeholder="Brief description of this app"></textarea>
              </div>
              <div class="md:col-span-2">
                <label class="block text-gray-300 mb-2">App URL</label>
                <input type="url" id="appUrl" class="w-full bg-black/30 border border-white/20 rounded-lg p-3 text-white outline-none focus:border-purple-400/50" placeholder="https://example.com">
              </div>
              
              <div class="md:col-span-2">
                <label class="block text-gray-300 mb-2">Icon Type</label>
                <div class="flex gap-4 mb-4">
                  <button class="icon-type-btn glass px-4 py-2 rounded-lg text-white transition-all duration-300 hover:-translate-y-1" data-type="fontawesome" onclick="selectIconType('app', 'fontawesome')">
                    <i class="fas fa-icons"></i>
                    FontAwesome
                  </button>
                  <button class="icon-type-btn glass px-4 py-2 rounded-lg text-white transition-all duration-300 hover:-translate-y-1" data-type="image" onclick="selectIconType('app', 'image')">
                    <i class="fas fa-image"></i>
                    Image URL
                  </button>
                </div>
                
                <div id="appFontAwesomeInput" class="hidden">
                  <div class="flex gap-2 items-center">
                    <input type="text" id="appFontAwesome" class="flex-1 bg-black/30 border border-white/20 rounded-lg p-3 text-white outline-none focus:border-purple-400/50" placeholder="fas fa-gamepad" oninput="updateIconPreview('app', this.value)">
                    <i id="appIconPreview" class="fas fa-cube text-2xl text-white"></i>
                    <button type="button" id="appIconPickerBtn" class="glass px-4 py-3 rounded-lg text-white transition-all duration-300 hover:-translate-y-1" data-iconpicker-input="input#appFontAwesome" data-iconpicker-preview="i#appIconPreview">
                      <i class="fas fa-search"></i>
                    </button>
                  </div>
                  <p class="text-gray-400 text-xs mt-2">Enter FontAwesome class or use the search button. Examples: fas fa-home, fab fa-github, fas fa-star</p>
                </div>
                <div id="appImageInput" class="hidden">
                  <input type="url" id="appImageUrl" class="w-full bg-black/30 border border-white/20 rounded-lg p-3 text-white outline-none focus:border-purple-400/50" placeholder="https://example.com/icon.png">
                </div>
              </div>
            </div>
          </div>

          <div class="flex gap-3 justify-end mt-8">
            <button class="glass px-6 py-3 rounded-xl text-white transition-all duration-300 hover:-translate-y-1" onclick="closeModal('manualCreatorModal')">Cancel</button>
            <button id="createItemBtn" class="glass px-6 py-3 rounded-xl text-white transition-all duration-300 hover:-translate-y-1 flex items-center gap-2" onclick="createItem()">
              <i class="fas fa-plus"></i>
              Create
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>
  <footer class="w-full py-4 text-center animate-fadeIn delay-4">
    <p class="text-gray-500 text-xs">© 2025 Gloss. All rights reserved.</p>
  </footer>

  
  <script src="https://furcan.github.io/IconPicker/dist/iconpicker-1.5.0.js"></script>  <script>
    const defaultCategories = {
      games: { name: "Games", icon: "fas fa-gamepad", description: "Racing, action, puzzle games and more" },
      productivity: { name: "Productivity", icon: "fas fa-briefcase", description: "Tools to boost your workflow" },
      entertainment: { name: "Entertainment", icon: "fas fa-film", description: "Movies, music, and streaming" },
      education: { name: "Education", icon: "fas fa-graduation-cap", description: "Learning and skill development" },
      social: { name: "Social", icon: "fas fa-users", description: "Connect with friends and communities" },
      utilities: { name: "Utilities", icon: "fas fa-tools", description: "Essential tools and utilities" }
    };

    const appDatabase = {
      games: [
        { id: 1, name: "2048", description: "Addictive number puzzle game", icon: "fas fa-th", url: "/browser?q=" + btoa("https://2048game.com") },
        { id: 2, name: "Slope", description: "Fast-paced 3D running game", icon: "fas fa-running", url: "/browser?q=" + btoa("https://slope-game.github.io/slope/") },
        { id: 3, name: "Wordle", description: "Daily word guessing game", icon: "fas fa-spell-check", url: "/browser?q=" + btoa("https://www.nytimes.com/games/wordle/") },
        { id: 4, name: "Snake", description: "Classic arcade snake game", icon: "fas fa-snake", url: "/browser?q=" + btoa("https://playsnake.org/") },
        { id: 5, name: "Tetris", description: "Classic block puzzle game", icon: "fas fa-cube", url: "/browser?q=" + btoa("https://tetris.com/play-tetris") }
      ],
      productivity: [
        { id: 6, name: "Google Drive", description: "Cloud storage and file sharing", icon: "fab fa-google-drive", url: "/browser?q=" + btoa("https://drive.google.com") },
        { id: 7, name: "Notion", description: "All-in-one workspace for notes and tasks", icon: "fas fa-sticky-note", url: "/browser?q=" + btoa("https://notion.so") },
        { id: 8, name: "GitHub", description: "Developer platform for code collaboration", icon: "fab fa-github", url: "/browser?q=" + btoa("https://github.com") },
        { id: 9, name: "Google Docs", description: "Online document editor", icon: "fas fa-file-word", url: "/browser?q=" + btoa("https://docs.google.com") },
        { id: 10, name: "Trello", description: "Project management with boards", icon: "fab fa-trello", url: "/browser?q=" + btoa("https://trello.com") }
      ],
      entertainment: [
        { id: 11, name: "YouTube", description: "Video streaming platform", icon: "fab fa-youtube", url: "/browser?q=" + btoa("https://youtube.com") },
        { id: 12, name: "Netflix", description: "Streaming movies and TV shows", icon: "fas fa-film", url: "/browser?q=" + btoa("https://netflix.com") },
        { id: 13, name: "Spotify", description: "Music streaming service", icon: "fab fa-spotify", url: "/browser?q=" + btoa("https://open.spotify.com") },
        { id: 14, name: "Twitch", description: "Live streaming platform", icon: "fab fa-twitch", url: "/browser?q=" + btoa("https://twitch.tv") },
        { id: 15, name: "Reddit", description: "Social news aggregation", icon: "fab fa-reddit", url: "/browser?q=" + btoa("https://reddit.com") }
      ],
      education: [
        { id: 16, name: "Khan Academy", description: "Free online learning platform", icon: "fas fa-graduation-cap", url: "/browser?q=" + btoa("https://khanacademy.org") },
        { id: 17, name: "Coursera", description: "Online courses from universities", icon: "fas fa-university", url: "/browser?q=" + btoa("https://coursera.org") },
        { id: 18, name: "Duolingo", description: "Language learning app", icon: "fas fa-language", url: "/browser?q=" + btoa("https://duolingo.com") },
        { id: 19, name: "Wikipedia", description: "Free online encyclopedia", icon: "fab fa-wikipedia-w", url: "/browser?q=" + btoa("https://wikipedia.org") }
      ],
      social: [
        { id: 20, name: "Discord", description: "Voice and text chat for communities", icon: "fab fa-discord", url: "/browser?q=" + btoa("https://discord.com/app") },
        { id: 21, name: "Twitter", description: "Social media platform", icon: "fab fa-twitter", url: "/browser?q=" + btoa("https://twitter.com") },
        { id: 22, name: "Instagram", description: "Photo and video sharing", icon: "fab fa-instagram", url: "/browser?q=" + btoa("https://instagram.com") },
        { id: 23, name: "WhatsApp Web", description: "Web version of WhatsApp", icon: "fab fa-whatsapp", url: "/browser?q=" + btoa("https://web.whatsapp.com") }
      ],
      utilities: [
        { id: 24, name: "Google Translate", description: "Translate text between languages", icon: "fas fa-language", url: "/browser?q=" + btoa("https://translate.google.com") },
        { id: 25, name: "Calculator", description: "Online calculator", icon: "fas fa-calculator", url: "/browser?q=" + btoa("https://calculator.net") },
        { id: 26, name: "Color Picker", description: "Pick and generate colors", icon: "fas fa-palette", url: "/browser?q=" + btoa("https://htmlcolorcodes.com") }
      ]
    };

    let currentCategory = '';
    let currentApps = [];
    let categories = { ...defaultCategories };

    function saveToLocalStorage() {
      try {
        const data = {
          categories: categories,
          appDatabase: appDatabase,
          lastUpdated: new Date().toISOString()
        };
        localStorage.setItem('glossExploreData', JSON.stringify(data));
        console.log('Data saved to localStorage');
      } catch (error) {
        console.error('Failed to save to localStorage:', error);
      }
    }

    function loadFromLocalStorage() {
      try {
        const savedData = localStorage.getItem('glossExploreData');
        if (savedData) {
          const data = JSON.parse(savedData);
          
          categories = { ...defaultCategories, ...data.categories };
          
          if (data.appDatabase) {
            Object.keys(data.appDatabase).forEach(key => {
              appDatabase[key] = data.appDatabase[key];
            });
          }
          
          console.log('Data loaded from localStorage');
          return true;
        }
      } catch (error) {
        console.error('Failed to load from localStorage:', error);
      }
      return false;
    }

    function clearLocalStorage() {
      try {
        localStorage.removeItem('glossExploreData');
        console.log('LocalStorage cleared');
      } catch (error) {
        console.error('Failed to clear localStorage:', error);
      }
    }

    function generateCategories() {
      const grid = document.getElementById('categoryGrid');
      grid.innerHTML = '';
      
      Object.entries(categories).forEach(([key, category]) => {
        const categoryCard = document.createElement('div');
        categoryCard.className = 'glass p-8 rounded-2xl text-center cursor-pointer transition-all duration-300 hover:-translate-y-2 hover:border-purple-400/30';
        categoryCard.onclick = () => selectCategory(key);
        
        const isImageIcon = category.icon && (category.icon.startsWith('http') || category.icon.startsWith('data:'));
        const isFontAwesome = category.icon && category.icon.includes('fa-');
        
        let iconHTML;
        if (isImageIcon) {
          iconHTML = `<img src="${category.icon}" alt="${category.name}" class="w-16 h-16 mx-auto mb-4 rounded-xl object-cover">`;
        } else if (isFontAwesome) {
          iconHTML = `<div class="text-5xl mb-4"><i class="${category.icon}"></i></div>`;
        } else {
          iconHTML = `<div class="text-5xl mb-4">${category.icon}</div>`;
        }
        
        categoryCard.innerHTML = `
          ${iconHTML}
          <h3 class="text-lg font-semibold text-white mb-2">${category.name}</h3>
          <p class="text-gray-400 text-sm">${category.description}</p>
        `;
        
        grid.appendChild(categoryCard);
      });
    }

    function selectCategory(category) {
      currentCategory = category;
      currentApps = appDatabase[category] || [];
      
      const categoryView = document.getElementById('categoryView');
      categoryView.classList.add('fade-out');
      
      setTimeout(() => {
        categoryView.classList.add('hidden');
        const appListView = document.getElementById('appListView');
        appListView.classList.remove('hidden');
        appListView.classList.add('fade-in');
        
        loadInitialApps();
      }, 300);
    }

    function goBackToCategories() {
      const appListView = document.getElementById('appListView');
      appListView.classList.add('fade-out');
      
      setTimeout(() => {
        appListView.classList.add('hidden');
        appListView.classList.remove('fade-in', 'fade-out');
        
        const categoryView = document.getElementById('categoryView');
        categoryView.classList.remove('hidden', 'fade-out');
        categoryView.classList.add('fade-in');
        
        document.getElementById('appContainer').innerHTML = '';
      }, 300);
    }

    function loadInitialApps() {
      const container = document.getElementById('appContainer');
      container.innerHTML = '';
      
      currentApps.forEach((app, index) => {
        setTimeout(() => {
          addAppToDOM(app, index);
        }, index * 50);
      });
    }

    function addAppToDOM(app, index = 0) {
      const container = document.getElementById('appContainer');
      const appElement = document.createElement('div');
      appElement.className = 'flex items-center p-4 mb-2 rounded-xl cursor-pointer transition-all duration-300 relative overflow-hidden bg-white/[0.02] border border-transparent opacity-0 translate-y-5 hover:border-purple-400/30 hover:translate-x-1';
      appElement.onclick = () => openApp(app.url);
      
      setTimeout(() => {
        appElement.classList.remove('opacity-0', 'translate-y-5');
        appElement.classList.add('opacity-100', 'translate-y-0');
      }, 50);
      
      const isImageIcon = app.icon && (app.icon.startsWith('http') || app.icon.startsWith('data:'));
      const iconHTML = isImageIcon 
        ? `<img src="${app.icon}" alt="${app.name}" class="w-12 h-12 rounded-xl mr-4 object-cover flex-shrink-0">`
        : `<div class="w-12 h-12 rounded-xl mr-4 flex items-center justify-center glass"><i class="${app.icon || 'fas fa-cube'} text-2xl text-white"></i></div>`;
      
      appElement.innerHTML = `
        ${iconHTML}
        <div class="flex-1">
          <div class="text-lg font-semibold text-white mb-1">${app.name}</div>
          <div class="text-sm text-white/70 leading-relaxed">${app.description}</div>
        </div>
      `;
      
      container.appendChild(appElement);
    }

    function filterAndSortApps() {
      if (!currentApps.length) return;
      
      const searchTerm = document.getElementById('appSearch').value.toLowerCase();
      const sortOption = document.getElementById('sortFilter').value;
      
      let filtered = (appDatabase[currentCategory] || []).filter(app => 
        app.name.toLowerCase().includes(searchTerm) || 
        app.description.toLowerCase().includes(searchTerm)
      );
      
      switch(sortOption) {
        case 'name-asc':
          filtered.sort((a, b) => a.name.localeCompare(b.name));
          break;
        case 'name-desc':
          filtered.sort((a, b) => b.name.localeCompare(a.name));
          break;
        case 'popular':
          filtered.sort((a, b) => a.id - b.id);
          break;
        case 'recent':
          filtered.sort((a, b) => b.id - a.id);
          break;
      }
      
      currentApps = filtered;
      loadInitialApps();
    }

    function openImportModal() {
      const modal = document.getElementById('importModal');
      modal.classList.remove('opacity-0', 'invisible');
      modal.classList.add('opacity-100', 'visible');
    }

    function openExportModal() {
      generateExportOptions();
      const modal = document.getElementById('exportModal');
      modal.classList.remove('opacity-0', 'invisible');
      modal.classList.add('opacity-100', 'visible');
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.classList.add('opacity-0', 'invisible');
      modal.classList.remove('opacity-100', 'visible');
    }

    function generateExportOptions() {
      const container = document.getElementById('exportOptions');
      container.innerHTML = '';
      
      Object.entries(categories).forEach(([key, category]) => {
        const div = document.createElement('div');
        div.className = 'flex items-center gap-2 mb-2 p-2 rounded-lg transition-colors hover:bg-white/10';
        div.innerHTML = `
          <input type="checkbox" id="export-${key}" class="export-category" value="${key}">
          <label for="export-${key}" class="text-white cursor-pointer">${category.name}</label>
        `;
        container.appendChild(div);
      });
      
      document.querySelectorAll('.export-category').forEach(checkbox => {
        checkbox.addEventListener('change', updateExportPreview);
      });
    }

    function updateExportPreview() {
      const selectedCategories = Array.from(document.querySelectorAll('.export-category:checked')).map(cb => cb.value);
      const exportData = { categories: {} };
      
      selectedCategories.forEach(categoryKey => {
        if (categories[categoryKey] && appDatabase[categoryKey]) {
          exportData.categories[categoryKey] = {
            ...categories[categoryKey],
            apps: appDatabase[categoryKey]
          };
        }
      });
      
      document.getElementById('exportData').value = JSON.stringify(exportData, null, 2);
    }

    function importFromJSON() {
      try {
        const jsonData = JSON.parse(document.getElementById('importData').value);
        
        if (jsonData.categories) {
          Object.entries(jsonData.categories).forEach(([key, categoryData]) => {
            if (categoryData.apps) {
              categories[key] = {
                name: categoryData.name || key,
                icon: categoryData.icon || '📱',
                description: categoryData.description || 'Imported category'
              };
              appDatabase[key] = categoryData.apps;
            }
          });
          
          generateCategories();
          closeModal('importModal');
          
          saveToLocalStorage();
          
          alert('Import successful!');
        }
      } catch (error) {
        alert('Invalid JSON format. Please check your data.');
      }
    }

    function copyToClipboard() {
      const exportData = document.getElementById('exportData');
      exportData.select();
      document.execCommand('copy');

      alert('Copied to clipboard!');
    }

    function openApp(url) {
      window.location.href = url;
    }

    let currentCreationType = '';

    function openManualCreatorModal() {
      resetCreatorForm();
      const modal = document.getElementById('manualCreatorModal');
      modal.classList.remove('opacity-0', 'invisible');
      modal.classList.add('opacity-100', 'visible');
  
      setTimeout(() => {
        initializeIconPickers();
      }, 100);
    }

    function resetCreatorForm() {
      document.getElementById('creationForm').classList.add('hidden');
      document.getElementById('categoryForm').classList.add('hidden');
      document.getElementById('appForm').classList.add('hidden');
      
      document.querySelectorAll('#manualCreatorModal input, #manualCreatorModal textarea, #manualCreatorModal select').forEach(field => {
        field.value = '';
      });

      document.querySelectorAll('.icon-type-btn').forEach(btn => {
        btn.classList.remove('border-purple-400');
      });

      document.querySelectorAll('[id$="Input"]').forEach(field => {
        field.classList.add('hidden');
      });
      
      document.querySelectorAll('.iconpicker-initialized').forEach(btn => {
        btn.classList.remove('iconpicker-initialized');
        btn.removeAttribute('data-iconpicker');
      });

      document.querySelectorAll('.iconpicker-popover').forEach(popover => {
        popover.remove();
      });
    
      document.getElementById('categoryIconPreview').className = 'fas fa-folder text-2xl text-white';
      document.getElementById('appIconPreview').className = 'fas fa-cube text-2xl text-white';
      
      currentCreationType = '';
    }

    function setCreationType(type) {
      currentCreationType = type;
      
      document.getElementById('creationForm').classList.remove('hidden');
   
      document.getElementById('categoryForm').classList.add('hidden');
      document.getElementById('appForm').classList.add('hidden');

      if (type === 'category') {
        document.getElementById('categoryForm').classList.remove('hidden');

        document.getElementById('categoryName').addEventListener('input', function() {
          const key = this.value.toLowerCase().replace(/[^a-z0-9]/g, '');
          document.getElementById('categoryKey').value = key;
        });
      } else if (type === 'app') {
        document.getElementById('appForm').classList.remove('hidden');
        populateAppCategories();
      }
    }

    function populateAppCategories() {
      const select = document.getElementById('appCategory');
      select.innerHTML = '<option value="">Select a category</option>';
      
      Object.entries(categories).forEach(([key, category]) => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = category.name;
        select.appendChild(option);
      });
    }

    function selectIconType(target, type) {
      console.log(`Selecting icon type ${type} for ${target}`);

      const targetForm = target === 'category' ? '#categoryForm' : '#appForm';
      document.querySelectorAll(`${targetForm} .icon-type-btn`).forEach(btn => {
        btn.classList.remove('border-purple-400');
      });
      
      const selectedBtn = document.querySelector(`${targetForm} .icon-type-btn[data-type="${type}"]`);
      if (selectedBtn) {
        selectedBtn.classList.add('border-purple-400');
      }
      
      document.querySelectorAll(`[id^="${target}"][id$="Input"]`).forEach(field => {
        field.classList.add('hidden');
      });
      
      let inputFieldId;
      if (type === 'fontawesome') {
        inputFieldId = `${target}FontAwesomeInput`;
      } else if (type === 'emoji') {
        inputFieldId = `${target}EmojiInput`;
      } else if (type === 'image') {
        inputFieldId = `${target}ImageInput`;
      } else {
        inputFieldId = `${target}${type.charAt(0).toUpperCase() + type.slice(1)}Input`;
      }
      
      const inputField = document.getElementById(inputFieldId);
      if (inputField) {
        inputField.classList.remove('hidden');
        console.log(`Showing input field: ${inputField.id}`);
        
        if (type === 'fontawesome') {
          setTimeout(() => {
            const buttonId = `${target}IconPickerBtn`;
            const button = document.getElementById(buttonId);
            
            console.log(`Attempting to initialize IconPicker for ${buttonId}`);
            
            if (button) {
              if (button.classList.contains('iconpicker-initialized')) {
                console.log(`Cleaning up existing IconPicker for ${buttonId}`);
                button.classList.remove('iconpicker-initialized');
              }

              document.querySelectorAll('.iconpicker-popover').forEach(popover => {
                popover.remove();
              });
              
              try {
                console.log(`Running IconPicker.Run for ${buttonId}`);

                if (typeof IconPicker !== 'undefined' && IconPicker.Run) {
                  IconPicker.Run(`#${buttonId}`);
                  button.classList.add('iconpicker-initialized');
                  console.log(`IconPicker initialized successfully for ${buttonId}`);

                  button.addEventListener('iconpickerSelected', function(e) {
                    console.log('Icon selected:', e.detail);
                    const iconClass = e.detail.value;
                    const previewElement = document.getElementById(`${target}IconPreview`);
                    const inputElement = document.getElementById(`${target}FontAwesome`);
                    
                    if (previewElement && iconClass) {
                      previewElement.className = iconClass + ' text-2xl text-white';
                    }
                    if (inputElement) {
                      inputElement.value = iconClass;
                    }
                  });
                } else {
                  console.error('IconPicker.Run is not available');
                  const inputElement = document.getElementById(`${target}FontAwesome`);
                  if (inputElement) {
                    inputElement.removeAttribute('readonly');
                    inputElement.placeholder = 'Enter FontAwesome class (e.g., fas fa-home)';
                  }
                }
                
              } catch (error) {
                console.error(`Failed to initialize IconPicker for ${buttonId}:`, error);
                const inputElement = document.getElementById(`${target}FontAwesome`);
                if (inputElement) {
                  inputElement.removeAttribute('readonly');
                  inputElement.placeholder = 'Enter FontAwesome class (e.g., fas fa-home)';
                }
              }
            } else {
              console.error(`Button ${buttonId} not found`);
            }
          }, 200);
        }
      } else {
        console.error(`Input field not found: ${inputFieldId}`);
      }
    }

    function updateIconPreview(target, iconClass) {
      const previewElement = document.getElementById(`${target}IconPreview`);
      if (previewElement && iconClass) {
        previewElement.className = `${iconClass.trim()} text-2xl text-white`;
      }
    }

    function initializeIconPickers() {
      try {
        const categoryBtn = document.getElementById('categoryIconPickerBtn');
        const appBtn = document.getElementById('appIconPickerBtn');
        
        if (categoryBtn && !categoryBtn.classList.contains('iconpicker-initialized')) {
          const categoryInput = categoryBtn.closest('#categoryFontAwesomeInput');
          if (categoryInput && !categoryInput.classList.contains('hidden')) {
            console.log('Initializing category IconPicker');
            IconPicker.Run('#categoryIconPickerBtn');
            categoryBtn.classList.add('iconpicker-initialized');
          }
        }
        
        if (appBtn && !appBtn.classList.contains('iconpicker-initialized')) {
          const appInput = appBtn.closest('#appFontAwesomeInput');
          if (appInput && !appInput.classList.contains('hidden')) {
            console.log('Initializing app IconPicker');
            IconPicker.Run('#appIconPickerBtn');
            appBtn.classList.add('iconpicker-initialized');
          }
        }
      } catch (error) {
        console.log('IconPicker initialization error:', error);
      }
    }

    function createItem() {
      if (currentCreationType === 'category') {
        createCategory();
      } else if (currentCreationType === 'app') {
        createApp();
      }
    }

    function createCategory() {
      const name = document.getElementById('categoryName').value.trim();
      const key = document.getElementById('categoryKey').value.trim();
      const description = document.getElementById('categoryDescription').value.trim();
      
      if (!name || !key) {
        alert('Please fill in the category name and key.');
        return;
      }
      
      if (categories[key]) {
        alert('A category with this key already exists.');
        return;
      }
      
      let icon = '📱'; 
      const selectedTypeBtn = document.querySelector('#categoryForm .icon-type-btn.border-purple-400');
      const selectedType = selectedTypeBtn?.dataset.type;
      
      console.log('Selected icon type for category:', selectedType);
      
      if (selectedType === 'emoji') {
        icon = document.getElementById('categoryEmoji').value.trim() || '📱';
      } else if (selectedType === 'fontawesome') {
        icon = document.getElementById('categoryFontAwesome').value.trim() || 'fas fa-folder';
        console.log('FontAwesome icon for category:', icon);
      } else if (selectedType === 'image') {
        icon = document.getElementById('categoryImageUrl').value.trim() || 'https://via.placeholder.com/48';
      }
      
      categories[key] = {
        name: name,
        icon: icon,
        description: description || 'Custom category'
      };
      
      console.log('Created category:', categories[key]);

      if (!appDatabase[key]) {
        appDatabase[key] = [];
      }
 
      generateCategories();

      saveToLocalStorage();

      closeModal('manualCreatorModal');
      
      alert('Category created successfully!');
    }

    function createApp() {
      const name = document.getElementById('appName').value.trim();
      const category = document.getElementById('appCategory').value;
      const description = document.getElementById('appDescription').value.trim();
      const url = document.getElementById('appUrl').value.trim();
      
      if (!name || !category || !url) {
        alert('Please fill in all required fields (name, category, URL).');
        return;
      }
      
      let icon = 'fas fa-cube';
      const selectedTypeBtn = document.querySelector('#appForm .icon-type-btn.border-purple-400');
      const selectedType = selectedTypeBtn?.dataset.type;
      
      console.log('Selected icon type for app:', selectedType);
      
      if (selectedType === 'fontawesome') {
        icon = document.getElementById('appFontAwesome').value.trim() || 'fas fa-cube';
        console.log('FontAwesome icon for app:', icon);
      } else if (selectedType === 'image') {
        icon = document.getElementById('appImageUrl').value.trim() || 'https://via.placeholder.com/48';
      }
      
      const newApp = {
        id: Date.now(), 
        name: name,
        description: description || 'Custom app',
        icon: icon,
        url: url.startsWith('http') ? `/browser?q=${btoa(url)}` : url
      };
      
      console.log('Created app:', newApp);
      
      if (!appDatabase[category]) {
        appDatabase[category] = [];
      }
      appDatabase[category].push(newApp);
      
      saveToLocalStorage();
      

      closeModal('manualCreatorModal');
      
      alert('App created successfully!');
    }

    function resetToDefaults() {
      if (confirm('Are you sure you want to reset all data to defaults? This will remove all custom categories and apps.')) {
        clearLocalStorage();

        categories = { ...defaultCategories };
        Object.keys(appDatabase).forEach(key => {
          if (!defaultCategories[key]) {
            delete appDatabase[key];
          }
        });
        
        generateCategories();

        const appListView = document.getElementById('appListView');
        if (!appListView.classList.contains('hidden')) {
          goBackToCategories();
        }
        
        alert('Reset to defaults successful!');
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      const dataLoaded = loadFromLocalStorage();

      generateCategories();
      
      if (dataLoaded) {
        console.log('Loaded saved data from localStorage');
      } else {
        console.log('Using default data');
      }

      function initIconPickerWhenReady() {
        if (typeof IconPicker !== 'undefined') {
          console.log('IconPicker library loaded successfully');
          try {
            IconPicker.Init({
              jsonUrl: '/_gloss/tools/fontawesome.json',
              searchPlaceholder: 'Search Icons',
              showAllButton: 'Show All',
              cancelButton: 'Cancel',
              noResultsFound: 'No results found.',
              borderRadius: '10px'
            });
            console.log('IconPicker initialized with local FontAwesome JSON');
          } catch (error) {
            console.error('IconPicker initialization failed:', error);
            try {
              IconPicker.Init();
              console.log('IconPicker initialized with default config');
            } catch (fallbackError) {
              console.error('IconPicker fallback initialization failed:', fallbackError);
            }
          }
        } else {
          console.log('IconPicker not loaded yet, retrying...');
          setTimeout(initIconPickerWhenReady, 100);
        }
      }
      
      initIconPickerWhenReady();
  
      let searchTimeout;
      const searchInput = document.getElementById('appSearch');
      if (searchInput) {
        searchInput.addEventListener('input', function() {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(filterAndSortApps, 300);
        });
      }
    
      const sortFilter = document.getElementById('sortFilter');
      if (sortFilter) {
        sortFilter.addEventListener('change', filterAndSortApps);
      }
      
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('fixed') && e.target.classList.contains('inset-0')) {
          const modalId = e.target.id;
          if (modalId) closeModal(modalId);
        }
      });
    });
  </script>
</body>
</html>